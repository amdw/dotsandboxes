\documentclass[a4paper,twocolumn]{article}

\usepackage{palatino}
\usepackage{amsthm}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{color}
\usepackage{calc}

\newtheorem{thm}{Theorem}[section]
\newtheorem{sstealing}[thm]{Theorem}
\newtheorem{addcoins}[thm]{Lemma}
\newtheorem{freecoins}[thm]{Theorem}
\newtheorem{halfheartedbad}[thm]{Theorem}
\newtheorem{hardheartedbeatsloony}[thm]{Theorem}

\begin{document}

\title{The Dots-and-Boxes Game}
\author{Andrew Medworth (\texttt{https://github.com/amdw})}
\date{\today}
\maketitle

\begin{abstract}
  An introduction to the game dots-and-boxes, and the more general game
  strings-and-coins. Aims to explain why the game is interesting, and discuss
  some strategic techniques, giving mathematical proofs where appropriate.
\end{abstract}

\tableofcontents

\section{Introduction}

\subsection{The rules of dots-and-boxes}

Dots-and-boxes is a game for two players.

\begin{enumerate}
  \item The game is played on a rectangular grid of dots.
  \item The players take it in turns to draw a line of their choice
    connecting a pair of horizontally or vertically adjacent dots.
  \item If a player completes a $1 \times 1$ box, she scores a point
    (normally recorded by writing her initial inside it) and
    \emph{must} make another move: a player's turn only comes to an
    end when she makes a move which does not complete a box.
  \item The game ends when all boxes have been completed; the winner
    is the player who has completed more boxes.
\end{enumerate}

An example game is shown in Figure TODO.

The rules of dots-and-boxes are very simple: the rules can be learned in
moments, and it can be played purely with pencil and paper. The size of the
board can be varied to alter the simplicity and length of the game: the board
with $5 \times 5$ boxes is already quite deep. The strategy of the game is quite
complex and interesting, and the aim of this paper is to explore it in more
detail.

\subsection{Strings-and-coins}

Dots-and-boxes is a special case of a more general game called
\emph{strings-and-coins}.

\begin{enumerate}
  \item This game begins with a set of coins, and a set of strings
    each connecting a pair of coins; some coins also have one or more
    strings connecting them to the ground.
  \item The players take it in turns to remove one string of their
    choice.
  \item If a player removes the last string connected to a coin, she
    wins the coin, removing it from the game, and \emph{must} play
    another move, her turn ending only when she removes a string which
    does not win any coins.
  \item The game ends when all coins are gone; the winner is the
    player who has captured more coins.
\end{enumerate}

The $m \times n$ game of dots-and-boxes is the special case of
strings-and-coins where $mn$ coins are connected in a rectangular $m
\times n$ grid, with the outer coins connected to the ground. The
strings-and-coins game parallel to the dots-and-boxes game in Figure
TODO is shown in Figure TODO; connections to the ground are indicated
by arrows.

Strings-and-coins is a more general game, because it is possible to
start with a graph (indeed, a multigraph, since the same pair of coins
can be joined by more than one string) of any shape and connectivity
whatsoever.

Anything we learn about strings-and-coins will also apply to
dots-and-boxes; we will therefore mostly focus our attention on
strings-and-coins, occasionally making reference to dots-and-boxes
where something we learn has specific implications there.

\section{Definitions and basic strategy}

\subsection{Basic terminology}

Where possible, I have tried to be consistent with the standard
terminology of mathematical graph theory, and with existing literature
such as \cite{berl}.

We will call the two players $A$ and $B$, with $A$ generally moving
first in a given position.

The \emph{valency} or \emph{degree} of a coin is the number of strings
connected to it (these terms are borrowed from graph theory). In the
starting position of dots-and-boxes, all coins have valency 4; each
move reduces the valency of either one or two coins by 1. A coin of
valency 1 can be immediately captured.

A \emph{joint} is a coin of degree 3 or more.

A \emph{loop} is a connected set of coins which all have valency 2, and
form a circuit. An $n$-loop is a loop consisting of $n$ coins. (In
dots-and-boxes, there are no loops with fewer than 4 coins, and due to
the symmetry, all loops have an even number of coins.)

A \emph{(closed) chain} is a connected set of coins with valency 2
which is not a loop. A chain has two ends, which can either be
connected to the ground or to a joint. An \emph{open chain} is one
which can be immediately captured, i.e. a chain where one or both ends
has valency 1. A $n$-chain is a chain consisting of $n$ coins.

The act of \emph{opening} a chain or loop is cutting it so that it
becomes an open chain, which can then be captured.

A \emph{double-cross move} is a move which wins two coins at once
(because the string removed connected two coins of valency 1). These
moves are of strategic importance for reasons we will see later.

Let $V(P)$ be the net value of a position $P$, assuming optimal play
from both sides, from the perspective of the player who has to play
first in it. Clearly $V(P)$ will be an integer, and could be either
positive, zero or negative, depending on whether $P$ is advantageous
for the first player. $V(P)$ is also known as the \emph{minimax} value
of $P$ and $V$ is the \emph{value function} of strings-and-coins.

\subsection{Basics of loony endgames}

To understand the strategy of a game, it is often a good idea to begin
with positions close to the end of the game, since the understanding
of earlier positions depends on later ones.

Let us consider a very simple endgame position $S_n$ consisting of a
single closed $n$-chain. Obviously $V(S_n)=-n$, as there is no
alternative but to open the chain for the opponent, who will take all
$n$ coins straight away.

Now consider the position $D_n$ with $2n$ coins divided into
\emph{two} closed $n$-chains. At first glance it might appear that
this position is a $n$--$n$ draw, as $A$ must open one chain for $B$,
who will take it and then be forced to open the other one for
$A$. However this is not true: when $A$ opens the first chain, $B$ can
take all but the last two boxes, and then sacrifice them with a
\emph{double-dealing move} as shown in Figure \ref{dddemo} (with
$n=5$). Because this move does not win a coin, it ends $B$'s turn, and
forces $A$ to make a move. $A$ might as well take the two sacrificed
coins, because in either case, he is again forced to open the
remaining chain for $B$, which $B$ then wins. Thus $B$ wins by $2n -
2$ points to 2, so $V(D_n) = 4-2n$.

\begin{figure}
  \centering
  \def\svgscale{0.7}
  \input{fig_doubledeal.pdf_tex}
  \caption{Maintaining control through double-dealing}
  \label{dddemo}
\end{figure}

Notice that this only works with $n \ge 3$: a closed chain of length 2
can be opened by removing the middle string, in which case a
double-dealing move is impossible. Only when $n \ge 3$ is there no way
to open a closed $n$-chain without allowing a double-dealing move.

A similar situation arises with loops, but with one important
difference: when a loop is opened, in order to play a double-dealing
move a player must sacrifice 4 boxes, rather than 2, as shown in
Figure TODO. This is because an opened loop has no link to the ground,
so the only way to avoid taking a coin at the end (and thus be forced
to continue making moves) is to take the string between two connected
pairs of coins, sacrificing both pairs. This means that a
double-dealing move is only possible with an $n$-loop if $n \ge 4$.

Double-dealing moves are an absolutely central concept in
strings-and-coins strategy, because they allow a player to maintain
\emph{control} of a position, to decide whether to play first in the
rest of the position or to force the opponent to do so.

Because of this, a \emph{long chain} is defined as a chain of at least
\emph{three} coins, and a \emph{long loop} is defined as a loop of at
least \emph{four} coins. A long chain or loop is one which cannot be
opened without allowing a double-dealing move. By contrast a
\emph{short} chain or loop is one which is not long.

(I do not particularly like this terminology, because the words
``long'' and ``short'' are such common words, and giving them a
specific technical meaning like this can often be confusing. However
they are standard in the dots-and-boxes literature, so throughout this
paper I have tried to consistently use ``long'' and ``short'' in this
technical sense, preferring ``big'' and ``small'' in more informal
contexts.)

Further, a \emph{loony move} is defined as a move which allows the
opponent to play a double-dealing move. There are four types of loony
move:

\begin{enumerate}
  \item Opening a long chain
  \item Opening a long loop
  \item Opening a 2-chain by cutting one of the links to the ground:
    this is called a \emph{half-hearted handout}, in contrast to a
    \emph{hard-hearted handout} which is opening the 2-chain by
    cutting the middle link (and is not a loony move).
  \item Handing one of these situations back to the opponent by
    playing in an unrelated area of the board when the opponent has
    made a loony move of their own.
\end{enumerate}

When a player makes a loony move, it hands over control of the
position to the opponent, and so if a player can force her opponent to
make a loony move, she is almost always winning. (We will discuss the
exceptions shortly.)

A \emph{loony endgame} is defined as a strings-and-coins position in
which the only possible moves are loony moves.

These central concepts of strings-and-coins strategy bring us to our
first theorem.

\begin{sstealing} \label{sstealing}
  If a player has just made a loony move resulting in position $L$,
  her opponent can score at least half of the remaining points,
  regardless of the rest of the position: in other words, $V(L) \ge
  0$.
\end{sstealing}

\begin{proof}
  Let $P$ be the position with the coins offered by the loony move
  removed.
  
  The proof uses a technique called \emph{strategy-stealing}. It
  relies on the fact that from $L$, the player to move can choose
  whether to take all the coins on offer and play first in $P$, or
  play a double-dealing move, sacrificing a few coins but forcing the
  opponent to play first in $P$.

  Let $s$ be the minimum number of coins the player would have to
  sacrifice in order to play a double-dealing move, and let $m$ be the
  total number of coins placed on offer by the loony move. Note that
  $s$ is either 2 or 4, depending on whether a chain or a loop has
  been opened, and $m \ge s$.

  By taking all the coins and playing first in $P$, the player's
  outcome would be $m + V(P)$. By taking all but $s$ coins and forcing
  the opponent to play first in $P$, the player's outcome would be
  $m-2s-V(P)$. So $$V(L) = \max(m+V(P), m-2s-V(P))$$

  If $m+V(P) \ge 0$ then $V(L) \ge 0$ straight away, so suppose
  $m+V(P) < 0$. Then as $m \ge s$, $$m-2s-V(P) > 2m-2s \ge 0$$ so in
  this case $V(L) \ge 0$ also.
\end{proof}

This argument shows that it is \emph{generally} undesirable to make a
loony move; that is not always the case, though, as sometimes the
alternatives are actually worse. We will see some examples in section
\ref{smallchains}.

However the third and fourth types of loony move can never be the sole
optimal move, and we will prove that now.

\begin{addcoins}\label{addcoins}
  For any position $P$, if $P'$ is the position resulting from adding
  $n$ capturable coins to $P$, then $V(P') \ge V(P)+n$.
\end{addcoins}
\begin{proof}
  This is immediate, as a gain of $V(P)+n$ coins can be made from $P'$
  by taking the $n$ available coins and then following the optimal
  strategy in $P$. (There may of course be a better strategy
  available.)
\end{proof}

\begin{freecoins}\label{freecoins}
  Any coins which can be captured without affecting the ability to
  play a double-dealing move later in the turn should always be
  captured immediately.
\end{freecoins}
\begin{proof}
  Let:
  \begin{itemize}
    \item $P$ be the current position
    \item $n$ be the maximum number of coins we can capture without
      affecting the ability to play a double-dealing move
    \item $P_t$ the position after we capture all possible coins from
      $P$ and then make the optimal move in the remaining position
    \item $P_d$ the position resulting from taking $n$ coins from $P$
      and then making a double-dealing move
  \end{itemize}

  If we take any number of coins $m < n$ and then play a
  double-dealing move, the resulting position is the same as $P_d$ but
  with $n-m$ extra capturable coins, so by lemma \ref{addcoins}, its
  value is at least $n-m$ greater than $V(P_d)$.

  Similarly, if we take any number of coins $m < n$, ignore the rest
  of the coins, and then play a non-double-dealing move, its value
  will be at least $n-m$ greater than $V(P_t)$.

  Thus, in either case, if we refrain from taking any other available
  coins, the opponent can take those coins and then play whatever
  optimal strategy they could have played if we had taken them. Thus
  we have achieved nothing except giving the opponent some free coins
  (and perhaps some other possibilities too, such as making a
  double-dealing move of their own.)
\end{proof}

\begin{halfheartedbad}
  A half-hearted handout is never better than a hard-hearted handout.
\end{halfheartedbad}
\begin{proof}
  Let $P$ be the position without the two coins concerned.

  The value of the position after the hard-hearted handout is
  $2+V(P)$, as the two coins should always be captured by Theorem
  \ref{freecoins}.
  
  A half-hearted handout by $A$ gives $B$ the choice whether to take
  the two coins and play first in $P$, or to play a double-dealing
  move and force $A$ to play first in $P$. So the value of the
  position after the half-hearted handout is $$\max(2+V(P),-2-V(P))
  \ge 2+V(P)$$ by definition of $\max$.
\end{proof}

\subsection{Control}
\label{smallchains}

From the preceding discussion, it is clear that the concept of control
is extremely important to understanding a dots-and-boxes
position. However, the winner in strings-and-coins is the player who
wins most coins, not the player who makes the last move or controls
the flow of the play. This section explores the relationship between
these two concepts.

First, suppose we have a position composed of an arbitrary
sub-position $S$ and a single chain with more coins than in all of
$P$. In this case, since the big chain contains more than half the
coins, the game will be won by whichever player can win it: neither
player will open the big chain unless they have no choice, so both
players will strive \emph{not} to take the last coin in $S$. In this
case control of $S$ will determine the outcome of the game.

In general, the more a position is dominated by chains and loops with
a large number of coins, the more important it is to have control,
because this will determine who is forced to give them away.

The complication comes from the fact that when a small enough chain
and or loop is opened, keeping control requires a net sacrifice of
coins, so if the position is dominated by such structures, naively
keeping control all the way to the end can result in defeat. It is in
these contexts that giving away control with a loony move can actually
be the optimal approach.

A chain or loop which does not require a net loss of coins to make a
double-dealing move is defined as \emph{very long}. Because making a
double-dealing move in a chain requires a sacrifice of two coins and
in a loop requires four coins, we now have the following
classification:

\begin{itemize}
  \item Chains of length 1 and 2 and loops of length 1, 2 or 3 are
    short (as they can always be opened with a non-loony move)
  \item Chains of length 3 and loops of length 4, 5, 6 or 7 are long
    but not very long (as they can only be opened with a loony move,
    but keeping control with a double-dealing move requires a net loss
    of coins)
  \item Larger chains and loops are both long and very long (these can
    only be opened with a loony move, after which control can be kept
    with no net loss).
\end{itemize}

(Again I register my objection to this terminology, but it is standard
and I will stick to it.)

We will now examine how smaller chains and loops affect
strings-and-coins positions.

\subsubsection{Long but not very long chains and loops}

Here we examine the effect of small long chains and loops by
considering a family of loony endgame positions $P_{i,k}$ consisting
of $i$ 3-chains and one $k$-chain, with $k \ge 3$. For example,
$P_{4,5}$ is shown in Figure \ref{p45}.

\begin{figure}
  \centering
  \def\svgscale{0.7}
  \input{fig_p45.pdf_tex}
  \caption{Position $P_{4,5}$}
  \label{p45}
\end{figure}

In $P_{i,k}$, $A$ can choose whether to open the $k$-chain or one of
the 3-chains, and in response, $B$ can choose whether to take the
whole chain or take all but two boxes and play a double-dealing move.

When you remove one chain from $P_{i,k}$, you reach another position
from the same family: removing the $k$-chain yields $P_{i-1,3}$ (which
consists purely of $i$ 3-chains), and removing one of the 3-chains
yields $P_{i-1,k}$. We can use this fact to compute the value of each
possible pair of moves from $V(P_{i,k})$ as described in table
\ref{vpikcomponents}.

\begin{table*}[tp]
  \centering
  \begin{tabular}{c | c c}
    & $A$ opens a 3-chain & $A$ opens the $k$-chain \\
    \hline
    $B$ takes & $-3-V(P_{i-1,k})$ & $-k-V(P_{i-1,3})$ \\
    $B$ double-deals & $1+V(P_{i-1,k})$ & $-k+4+V(P_{i-1,3})$
  \end{tabular}
  \caption{Values to $A$ of moves from $P_{i,k}$}
  \label{vpikcomponents}
\end{table*}

$A$ never does better to open the $k$-chain than one of the 3-chains,
so we can calculate $V(P_{i,k})$ as follows.

\begin{eqnarray*}
  V(P_{0,k}) & = & -k \\
  V(P_{i,k}) & = & \min(-3-V(P_{i-1,k}), 1+V(P_{i-1,k}))
\end{eqnarray*}

Example calculations for $k=3$, $k=4$ and $k=10$ can be seen in tables
\ref{vpik3}, \ref{vpik4} and \ref{vpik10}.

\begin{table*}[p]
  \centering
  \begin{tabular}{c c c c c c}
    $i$ & $V$ if $B$ takes & $V$ if $B$ double-deals & $V(P_{i,3})$ & $B$ taking optimal? & $B$ double-dealing optimal? \\
    \hline
    0 & -3 & -1 & -3 & Yes & No \\
    1 & 0 & -2 & -2 & No & Yes \\
    2 & -1 & -1 & -1 & Yes & Yes \\
    3 & -2 & 0 & -2 & Yes & No \\
    4 & -1 & -1 & -1 & Yes & Yes \\
    5 & -2 & 0 & -2 & Yes & No \\
    6 & -1 & -1 & -1 & Yes & Yes
  \end{tabular}
  \caption{$k=3$}
  \label{vpik3}
\end{table*}

\begin{table*}[p]
  \centering
  \begin{tabular}{c c c c c c}
    $i$ & $V$ if $B$ takes & $V$ if $B$ double-deals & $V(P_{i,4})$ & $B$ taking optimal? & $B$ double-dealing optimal? \\
    \hline
    0 & -4 & 0 & -4 & Yes & No \\
    1 & 1 & -3 & -3 & No & Yes \\
    2 & 0 & -2 & -2 & No & Yes \\
    3 & -1 & -1 & -1 & Yes & Yes \\
    4 & -2 & 0 & -2 & Yes & No \\
    5 & -1 & -1 & -1 & Yes & Yes \\
    6 & -2 & 0 & -2 & Yes & No \\
    7 & -1 & -1 & -1 & Yes & Yes \\
    8 & -2 & 0 & -2 & Yes & No
  \end{tabular}
  \caption{$k=4$}
  \label{vpik4}
\end{table*}

\begin{table*}[p]
  \centering
  \begin{tabular}{c c c c c c}
    $i$ & $V$ if $B$ takes & $V$ if $B$ double-deals & $V(P_{i,10})$ & $B$ taking optimal? & $B$ double-dealing optimal? \\
    \hline
    0 & -10 & 6 & -10 & Yes & No \\
    1 & 7 & -9 & -9 & No & Yes \\
    2 & 6 & -8 & -8 & No & Yes \\
    3 & 5 & -7 & -7 & No & Yes \\
    4 & 4 & -6 & -6 & No & Yes \\
    5 & 3 & -5 & -5 & No & Yes \\
    6 & 2 & -4 & -4 & No & Yes \\
    7 & 1 & -3 & -3 & No & Yes \\
    8 & 0 & -2 & -2 & No & Yes \\
    9 & -1 & -1 & -1 & Yes & Yes \\
    10 & -2 & 0 & -2 & Yes & No \\
    11 & -1 & -1 & -1 & Yes & Yes \\
    12 & -2 & 0 & -2 & Yes & No
  \end{tabular}
  \caption{$k=10$}
  \label{vpik10}
\end{table*}

We know from theorem \ref{sstealing} that no loony endgame can have a
positive value, but all the $V(P_{i,k})$ are strictly less than
zero. This is because the 3-chains have an odd number of coins, but
the number of coins you have to sacrifice to make a double-dealing
move is even, so the two never cancel out exactly.

(It is possible to construct a loony endgame position with value 0:
for example, the position consisting of two 4-loops shown in Figure
\ref{drawnloony}. In this case, taking the first loop would mean
sacrificing the second, while double-dealing the first loop would
sacrifice four coins to gain the second loop, with a draw in either
case.)

\begin{figure}
  \centering
  \def\svgscale{0.7}
  \input{fig_drawnloony.pdf_tex}
  \caption{A drawn loony endgame position}
  \label{drawnloony}
\end{figure}

Notice that the larger the value of $k$ (i.e. the bigger the big
chain), the longer double-dealing remains the optimal strategy for
$B$, the player in control. This is to be expected, as the bigger the
chain is, the more points it is worth sacrificing by double-dealing
from 3-chains to capture it.

However, in all cases, once $i$ is large enough (i.e. there are enough
3-chains), double-dealing after the opening of the first 3-chain
ceases to become the sole optimal strategy, and if there are an even
number of 3-chains, it ceases to become the optimal strategy at all.

The position consisting of four 3-chains, $P_{3,3}$, is a simple
counter-example to the notion that loony moves are always inferior to
non-loony moves. When $A$ opens the first 3-chain in this position,
$B$ does best to take it, winning 3 coins, and open the next 3-chain
for $A$, even though the latter is a loony move and a non-loony move
could have been played instead.

The reason is that giving away control by playing a loony move in the
position with three 3-chains, $P_{2,3}$, only loses one point, which
is more than offset by the three coins won in the process of reaching
that position. If instead $B$ had played a double-dealing move, he
would have been one point behind from the first chain, and only won
one point from $P_{2,3}$, so the game would have finished drawn.

A very similar analysis would apply if the 3-chains from this example
were replaced by loops of length 4, 5, 6 or 7. All these structures
require a sacrifice of coins in order to retain control, so a precise
analysis of the rest of the position is required in order to know
whether double-dealing or taking is the right strategy. If the rest of
the position is close in score, it may be better to take all the coins
on offer and play a loony move, even though there was a non-loony move
available.

\subsubsection{Short chains and loops}

Recall that the defining characteristic of a short chain or loop is
that it can be opened with a non-loony move; therefore, sacrificing it
does not entail giving up control of the position.

\begin{thebibliography}{99}
  \bibitem{berl} Elwyn Berlekamp, \emph{The Dots-and-Boxes Game},
    A~K~Peters 2000
\end{thebibliography}

\end{document}
