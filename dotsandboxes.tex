\documentclass[a4paper,twocolumn]{article}

\usepackage{palatino}
\usepackage{amsthm}

\newtheorem{thm}{Theorem}[section]
\newtheorem{sstealing}[thm]{Theorem}
\newtheorem{freecoins}[thm]{Theorem}
\newtheorem{halfheartedbad}[thm]{Theorem}

\begin{document}

\title{The Dots-and-Boxes Game}
\author{Andrew Medworth (\texttt{https://github.com/amdw})}
\date{\today}
\maketitle

\begin{abstract}
  An introduction to the game dots-and-boxes, and the more general game
  strings-and-coins. Aims to explain why the game is interesting, and discuss
  some strategic techniques, giving mathematical proofs where appropriate.
\end{abstract}

\tableofcontents

\section{Introduction}

\subsection{The rules of dots-and-boxes}

Dots-and-boxes is a game for two players.

\begin{enumerate}
  \item The game is played on a rectangular grid of dots.
  \item The players take it in turns to draw a line of their choice
    connecting a pair of horizontally or vertically adjacent dots.
  \item If a player completes a $1 \times 1$ box, she scores a point
    (normally recorded by writing her initial inside it) and
    \emph{must} make another move: a player's turn only comes to an
    end when she makes a move which does not complete a box.
  \item The game ends when all boxes have been completed; the winner
    is the player who has completed more boxes.
\end{enumerate}

An example game is shown in Figure TODO.

The rules of dots-and-boxes are very simple: the rules can be learned in
moments, and it can be played purely with pencil and paper. The size of the
board can be varied to alter the simplicity and length of the game: the board
with $5 \times 5$ boxes is already quite deep. The strategy of the game is quite
complex and interesting, and the aim of this paper is to explore it in more
detail.

\subsection{Strings-and-coins}

Dots-and-boxes is a special case of a more general game called
\emph{strings-and-coins}.

\begin{enumerate}
  \item This game begins with a set of coins, and a set of strings
    each connecting a pair of coins; some coins also have one or more
    strings connecting them to the ground.
  \item The players take it in turns to remove one string of their
    choice.
  \item If a player removes the last string connected to a coin, she
    wins the coin, removing it from the game, and \emph{must} play
    another move, her turn ending only when she removes a string which
    does not win any coins.
  \item The game ends when all coins are gone; the winner is the
    player who has captured more coins.
\end{enumerate}

The $m \times n$ game of dots-and-boxes is the special case of
strings-and-coins where $mn$ coins are connected in a rectangular $m
\times n$ grid, with the outer coins connected to the ground. The
strings-and-coins game parallel to the dots-and-boxes game in Figure
TODO is shown in Figure TODO; connections to the ground are indicated
by arrows.

Strings-and-coins is a more general game, because it is possible to
start with a graph (indeed, a multigraph, since the same pair of coins
can be joined by more than one string) of any shape and connectivity
whatsoever.

Anything we learn about strings-and-coins will also apply to
dots-and-boxes; we will therefore mostly focus our attention on
strings-and-coins, occasionally making reference to dots-and-boxes
where something we learn has specific implications there.

\section{Definitions and basic strategy}

\subsection{Basic terminology}

Where possible, I have tried to be consistent with the standard
terminology of mathematical graph theory, and with existing literature
such as \cite{berl}.

We will call the two players $A$ and $B$, with $A$ generally moving
first in a given position.

The \emph{valency} or \emph{degree} of a coin is the number of strings
connected to it (these terms are borrowed from graph theory). In the
starting position of dots-and-boxes, all coins have valency 4; each
move reduces the valency of either one or two coins by 1. A coin of
valency 1 can be immediately captured.

A \emph{joint} is a coin of degree 3 or more.

A \emph{loop} is a connected set of coins which all have valency 2, and
form a circuit. An $n$-loop is a loop consisting of $n$ coins. (In
dots-and-boxes, there are no loops with fewer than 4 coins, and due to
the symmetry, all loops have an even number of coins.)

A \emph{(closed) chain} is a connected set of coins with valency 2
which is not a loop. A chain has two ends, which can either be
connected to the ground or to a joint. An \emph{open chain} is one
which can be immediately captured, i.e. a chain where one or both ends
has valency 1. A $n$-chain is a chain consisting of $n$ coins.

The act of \emph{opening} a chain or loop is cutting it so that it
becomes an open chain, which can then be captured.

A \emph{double-cross move} is a move which wins two coins at once
(because the string removed connected two coins of valency 1). These
moves are of strategic importance for reasons we will see later.

Let $V(P)$ be the net value of a position $P$, assuming optimal play
from both sides, from the perspective of the player who has to play
first in it. Clearly $V(P)$ will be an integer, and could be either
positive, zero or negative, depending on whether $P$ is advantageous
for the first player. $V(P)$ is also known as the \emph{minimax} value
of $P$ and $V$ is the \emph{value function} of strings-and-coins.

\subsection{Basics of loony endgames}

To understand the strategy of a game, it is often a good idea to begin
with positions close to the end of the game, since the understanding
of earlier positions depends on later ones.

Let us consider a very simple endgame position $S_n$ consisting of a
single closed $n$-chain. Obviously $V(S_n)=-n$, as there is no
alternative but to open the chain for the opponent, who will take all
$n$ coins straight away.

Now consider the position $D_n$ with $2n$ coins divided into
\emph{two} closed $n$-chains. At first glance it might appear that
this position is a $n$--$n$ draw, as $A$ must open one chain for $B$,
who will take it and then be forced to open the other one for
$A$. However this is not true: when $A$ opens the first chain, $B$ can
take all but the last two boxes, and then sacrifice them with a
\emph{double-dealing move} as shown in Figure TODO. Because this move
does not win a coin, it ends $B$'s turn, and forces $A$ to make a
move. $A$ might as well take the two sacrificed coins, because in
either case, he is again forced to open the remaining chain for $B$,
which $B$ then wins. Thus $B$ wins by $2n - 2$ points to 2, so $V(D_n)
= 4-2n$.

Notice that this only works with $n \ge 3$: a closed chain of length 2
can be opened by removing the middle string, in which case a
double-dealing move is impossible. Only when $n \ge 3$ is there no way
to open a closed $n$-chain without allowing a double-dealing move.

A similar situation arises with loops, but with one important
difference: when a loop is opened, in order to play a double-dealing
move a player must sacrifice 4 boxes, rather than 2, as shown in
Figure TODO. This is because an opened loop has no link to the ground,
so the only way to avoid taking a coin at the end (and thus be forced
to continue making moves) is to take the string between two connected
pairs of coins, sacrificing both pairs. This means that a
double-dealing move is only possible with an $n$-loop if $n \ge 4$.

Double-dealing moves are an absolutely central concept in
strings-and-coins strategy, because they allow a player to maintain
\emph{control} of a position, to decide whether to play first in the
rest of the position or to force the opponent to do so.

Because of this, a \emph{long chain} is defined as a chain of at least
\emph{three} coins, and a \emph{long loop} is defined as a loop of at
least \emph{four} coins. A long chain or loop is one which cannot be
opened without allowing a double-dealing move. By contrast a
\emph{short} chain or loop is one which is not long.

(I do not particularly like this terminology, because the words
``long'' and ``short'' are such common words, and giving them a
specific technical meaning like this can often be confusing. However
they are standard in the dots-and-boxes literature, so throughout this
paper I have tried to consistently use ``long'' and ``short'' in this
technical sense, preferring ``big'' and ``small'' in more informal
contexts.)

Further, a \emph{loony move} is defined as a move which allows the
opponent to play a double-dealing move. There are four types of loony
move:

\begin{enumerate}
  \item Opening a long chain
  \item Opening a long loop
  \item Opening a 2-chain by cutting one of the links to the ground:
    this is called a \emph{half-hearted handout}, in contrast to a
    \emph{hard-hearted handout} which is opening the 2-chain by
    cutting the middle link (and is not a loony move).
  \item Handing one of these situations back to the opponent by
    playing in an unrelated area of the board when the opponent has
    made a loony move of their own.
\end{enumerate}

When a player makes a loony move, it hands over control of the
position to the opponent, and so if a player can force her opponent to
make a loony move, she is almost always winning. (We will discuss the
exceptions shortly.)

A \emph{loony endgame} is defined as a strings-and-coins position in
which the only possible moves are loony moves.

These central concepts of strings-and-coins strategy bring us to our
first theorem.

\begin{sstealing}
  If a player has just made a loony move resulting in position $L$,
  her opponent can score at least half of the remaining points,
  regardless of the rest of the position: in other words, $V(L) \ge
  0$.
\end{sstealing}

\begin{proof}
  Let $P$ be the position with the coins offered by the loony move
  removed.
  
  The proof uses a technique called \emph{strategy-stealing}. It
  relies on the fact that from $L$, the player to move can choose
  whether to take all the coins on offer and play first in $P$, or
  play a double-dealing move, sacrificing a few coins but forcing the
  opponent to play first in $P$.

  Let $s$ be the minimum number of coins the player would have to
  sacrifice in order to play a double-dealing move, and let $m$ be the
  total number of coins placed on offer by the loony move. Note that
  $s$ is either 2 or 4, depending on whether a chain or a loop has
  been opened, and $m \ge s$.

  By taking all the coins and playing first in $P$, the player's
  outcome would be $m + V(P)$. By taking all but $s$ coins and forcing
  the opponent to play first in $P$, the player's outcome would be
  $m-2s-V(P)$. So $$V(L) = \max(m+V(P), m-2s-V(P))$$

  If $m+V(P) \ge 0$ then $V(L) \ge 0$ straight away, so suppose
  $m+V(P) < 0$. Then as $m \ge s$, $$m-2s-V(P) > 2m-2s \ge 0$$ so in
  this case $V(L) \ge 0$ also.
\end{proof}

This argument shows that it is \emph{generally} undesirable to make a
loony move; that is not always the case, though, as sometimes the
alternatives are actually worse. We will see some counter-examples in
section \ref{smallchains}.

However the third and fourth types of loony move can never be the sole
optimal move, and we will prove that now.

\begin{freecoins}\label{freecoins}
  Any coins which can be captured without affecting the ability to
  play a double-dealing move later in the turn should always be
  captured immediately.
\end{freecoins}
\begin{proof}
  Let $P$ be the position with all capturable coins removed. Then
  as we have already seen, taking all available coins means we are
  obliged to play first in $P$, whereas making a double-dealing move
  (if possible) obliges the opponent to play first in $P$.

  In either case, if we refrain from taking any other available coins
  first, the opponent can take those coins and then play whatever
  optimal strategy they could have played. The only difference is that
  they have won some additional coins. Therefore nothing can ever be
  gained by refraining from capturing.

  (Not capturing may also give the opponent additional possibilities,
  such as making a double-dealing move of their own.)
\end{proof}

\begin{halfheartedbad}
  A half-hearted handout is never better than a hard-hearted handout.
\end{halfheartedbad}
\begin{proof}
  Let $P$ be the position without the two coins concerned.

  The value of the position after the hard-hearted handout is
  $2+V(P)$, as the two coins should always be captured by Theorem
  \ref{freecoins}.
  
  A half-hearted handout by $A$ gives $B$ the choice whether to take
  the two coins and play first in $P$, or to play a double-dealing
  move and force $A$ to play first in $P$. So the value of the
  position after the half-hearted handout is $$\max(2+V(P),-2-V(P))
  \ge 2+V(P)$$ by definition of $\max$.
\end{proof}

\subsection{Control}
\label{smallchains}

From the preceding discussion, it is clear that the concept of control
is extremely important to understanding a dots-and-boxes
position. However, the winner in strings-and-coins is the player who
wins most coins, not the player who makes the last move or controls
the flow of the play. This section explores the relationship between
these two concepts.

First, suppose we have a position composed of an arbitrary
sub-position $P$ and a single chain with more coins than in all of
$P$. In this case the game will be won by whichever player can win the
big chain: neither player will open the chain unless they have no
choice, so both players will strive \emph{not} to take the last coin
in $P$. In this case control of $P$ will determine the outcome of the
game.

In general, the more a position is dominated by chains and loops with
a large number of coins, the more important it is to have control,
because this will determine who is forced to give them away.

The complication comes from the fact that when a small enough chain
and or loop is opened, keeping control requires a net sacrifice of
coins, so if the position is dominated by such structures, naively
keeping control all the way to the end can result in defeat. It is in
these contexts that giving away control with a loony move can actually
be the optimal approach.

A chain or loop which does not require a net loss of coins to make a
double-dealing move is defined as \emph{very long}. Because making a
double-dealing move in a chain requires a sacrifice of two coins and
in a loop requires four coins, we now have the following
classification:

\begin{itemize}
  \item Chains of length 1 and 2 and loops of length 1, 2 or 3 are
    short (as they can always be opened with a non-loony move)
  \item Chains of length 3 and loops of length 4, 5, 6 or 7 are long
    but not very long (as they can only be opened with a loony move,
    but keeping control with a double-dealing move requires a net loss
    of coins)
  \item Larger chains and loops are both long and very long (these can
    only be opened with a loony move, after which control can be kept
    with no net loss).
\end{itemize}

(Again I register my objection to this terminology, but it is standard
and I will stick to it.)

\begin{thebibliography}{99}
  \bibitem{berl} Elwyn Berlekamp, \emph{The Dots-and-Boxes Game},
    A~K~Peters 2000
\end{thebibliography}

\end{document}
